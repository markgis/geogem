require_relative '../spec/spec_helper'

line = '378191.75 390015.55000000074505806, 378198.59999999962747097 390020.05000000074505806, 378198.59999999962747097 390020.05000000074505806'
point = '378197.19792838295688853 390015.77902741997968405'
site = '378217.70000000018626451 389999.80000000074505806, 378217.5 390000, 378211.59999999962747097 390006.40000000037252903, 378211.15000000037252903 390007.15000000037252903, 378210.84999999962747097 390007.90000000037252903, 378210.70000000018626451 390008.75, 378210.70000000018626451 390009.55000000074505806, 378210.84999999962747097 390010.34999999962747097, 378211.20000000018626451 390011.09999999962747097, 378211.59999999962747097 390011.65000000037252903, 378212.15000000037252903 390012.09999999962747097, 378212.75 390012.5, 378224.40000000037252903 390019.75, 378237.65000000037252903 390028.15000000037252903, 378242.75 390021.65000000037252903, 378238.95000000018626451 390018.30000000074505806, 378237.15000000037252903 390016.80000000074505806, 378217.95000000018626451 390000, 378217.70000000018626451 389999.80000000074505806'

large_site = '533739.05700000002980232 178476.0390000008046627, 533738.90000000037252903 178472.40300000086426735, 533738.71200000029057264 178471.54299999959766865, 533738.13900000043213367 178468.91300000064074993, 533737.44099999964237213 178465.93099999986588955, 533737.16199999954551458 178464.41300000064074993, 533736.99700000043958426 178463.51999999955296516, 533736.91999999992549419 178462.77500000037252903, 533736.80599999986588955 178461.67999999970197678, 533736.60599999967962503 178460.31299999915063381, 533736.60099999979138374 178460.26400000043213367, 533736.52799999993294477 178459.61800000071525574, 533736.48900000005960464 178459.26899999938905239, 533736.48900000005960464 178457.30100000090897083, 533736.53100000042468309 178455, 533736.76800000015646219 178452.67799999937415123, 533736.76800000015646219 178452.67600000090897083, 533736.90699999965727329 178450.04199999943375587, 533736.98099999967962503 178447.89399999938905239, 533736.83299999963492155 178446.41300000064074993, 533736.31400000024586916 178444.33899999968707561, 533735.85800000000745058 178442.84799999929964542, 533734.6969999996945262 178439.26600000075995922, 533734.0130000002682209 178437.42699999921023846, 533733.6919999998062849 178436.54800000041723251, 533732.38100000005215406 178433.4609999991953373, 533730.64400000032037497 178429.50899999961256981, 533729.96800000034272671 178428.02199999988079071, 533728.82000000029802322 178425.08999999985098839, 533728.38100000005215406 178424.02500000037252903, 533728.00700000021606684 178423.11800000071525574, 533727.57799999974668026 178422.3080000001937151, 533727.00200000032782555 178421.21900000050663948, 533726.70600000023841858 178420.62700000032782555, 533726.11500000022351742 178419.44400000013411045, 533725.14699999988079071 178417.42799999937415123, 533724.098000000230968 178415.25, 533722.60699999984353781 178412.58799999952316284, 533722.18699999991804361 178411.83200000040233135, 533721.39699999988079071 178410.41000000014901161, 533720.3169999998062849 178408.60999999940395355, 533719.94500000029802322 178407.99000000022351742, 533718.33100000023841858 178405.48900000005960464, 533716.79899999964982271 178402.98900000005960464, 533716.15299999993294477 178401.93999999947845936, 533715.02400000020861626 178400.24599999934434891, 533713.81400000024586916 178398.39100000075995922, 533710.00999999977648258 178393.00699999928474426, 533709.53899999987334013 178392.33999999985098839, 533707.02300000004470348 178389.16200000047683716, 533706.96999999973922968 178389.09500000067055225, 533706.47400000039488077 178388.46800000034272671, 533706.22499999962747097 178388.11999999918043613, 533704.25600000005215406 178385.36800000071525574, 533703.76200000010430813 178384.82300000078976154, 533666.598000000230968 178343.85199999995529652, 533659.81900000013411045 178343.40699999965727329, 533658.53399999998509884 178344.59500000067055225, 533639.42999999970197678 178361.99499999918043613, 533637.14699999988079071 178364.2890000008046627, 533612.31900000013411045 178385.55000000074505806, 533597.55999999959021807 178397.08000000007450581, 533587.5 178404.68999999947845936, 533572.68900000024586916 178415.23000000044703484, 533563.08899999968707561 178421.83999999985098839, 533562.73000000044703484 178427.10999999940395355, 533578.23000000044703484 178450.35999999940395355, 533579.18900000024586916 178452, 533611.82899999991059303 178500, 533612.51999999955296516 178501.01999999955296516, 533613.78000000026077032 178502.68999999947845936, 533631.46800000034272671 178528.86800000071525574, 533633.20899999979883432 178530.85999999940395355, 533652.07899999991059303 178552.48000000044703484, 533664.68900000024586916 178554.21000000089406967, 533683.11000000033527613 178541.07000000029802322, 533687.95899999979883432 178537.93999999947845936, 533692.94900000002235174 178535.18999999947845936, 533698.16999999992549419 178532.83999999985098839, 533703.12000000011175871 178529.85999999940395355, 533707.69900000002235174 178526.41000000014901161, 533709.03000000026077032 178525.24000000022351742, 533713.25 178521.05000000074505806, 533717.12999999988824129 178517.06000000052154064, 533721 178512.59999999962747097, 533724.5400000000372529 178508.26999999955296516, 533727.94900000002235174 178503.36999999918043613, 533730.24000000022351742 178500, 533731.04999999981373549 178498.81000000052154064, 533734.13999999966472387 178493.69999999925494194, 533734.87999999988824129 178492.21000000089406967, 533737.05700000002980232 178487.22199999913573265, 533738.09399999957531691 178484.25999999977648258, 533738.90899999998509884 178479.89000000059604645, 533739.05700000002980232 178476.0390000008046627'

RSpec.describe PerpendDistance do
  describe 'distance' do
    it 'returns distance from two points' do
      expect(PerpendDistance.new.distance(400000,200000,400100,200000)).to eq(100)
    end
  end

  describe 'node_split' do
    it 'returns nodes split as array of objects' do
      expect(PerpendDistance.new.node_split('0 1, 0 2, 0 4, 1 4, 2 4, 4 4')).to eq([{:x=>0, :y=>2}, {:x=>0, :y=>4}, {:x=>1, :y=>4}, {:x=>2, :y=>4}])
    end
  end

  describe 'first_node' do
    it 'returns the first node x and y from string' do
      expect(PerpendDistance.new.first_node('0 1, 0 2, 0 4, 1 4, 2 4, 4 4')).to eq(:point => {:x=>"0", :y=>"1"})
    end
  end

  describe 'first_node_plain' do
    it 'returns the first node x and y from string' do
      expect(PerpendDistance.new.first_node_plain(site)).to eq(['378217.70000000018626451','389999.80000000074505806'])
    end
  end

  describe 'last_node' do
    it 'returns the last node x and y from string' do
      expect(PerpendDistance.new.last_node('0 1, 0 2, 0 4, 1 4, 2 4, 4 4')).to eq(:point => {:x=>"4", :y=>"4"})
    end
  end

  describe 'line_point_distance' do
    it 'returns distance between line and point' do
      expect(PerpendDistance.new.line_point_distance(line, point)).to eq(2.799800776373077)
    end
  end

  describe 'n_node' do
    it 'returns third node from a line' do
      expect(PerpendDistance.new.n_node(site, 2)).to eq(['378211.59999999962747097','390006.40000000037252903'])
    end
  end

  describe 'perpend_thin' do
    it 'returns third node from a line' do
      actual = PerpendDistance.new.perpend_thin(site, 0.03)
      #puts actual
      expect(actual).to eq(['378211.59999999962747097','390006.40000000037252903'])
    end
  end
end
